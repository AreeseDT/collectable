{"version":3,"sources":["../lib/ts/shared/ownership.ts"],"names":[],"mappings":";AAAA,IAAI,OAAO,GAAG,CAAC,CAAC;AAChB;IACE,MAAM,CAAC,EAAE,OAAO,CAAC;AACnB,CAAC;AAFD,wBAEC;AAED,IAAI,MAAM,GAAG,CAAC,EAAE,MAAM,GAAG,CAAC,CAAC;AAU3B;IACE,EAAE,CAAA,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;QAChB,MAAM,GAAG,MAAM,EAAE,CAAC;IACpB,CAAC;IACD,IAAI,CAAC,CAAC;IACN,CAAC;IACD,MAAM,EAAE,CAAC;AACX,CAAC;AAED;IACE,EAAE,CAAA,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;QACd,EAAE,CAAA,CAAC,EAAE,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;YAChB,MAAM,CAAC,KAAK,CAAC;QACf,CAAC;QACD,MAAM,GAAG,CAAC,CAAC;IACb,CAAC;IACD,MAAM,CAAC,IAAI,CAAC;AACd,CAAC;AAEY,QAAA,KAAK,GAAe,MAAM,CAAC,MAAM,CAC5C,UAAU,QAAiC;IACzC,KAAK,EAAE,CAAC;IACR,IAAI,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC,CAAC;IAC9B,GAAG,EAAE,CAAC;IACN,MAAM,CAAC,MAAM,CAAC;AAChB,CAAC,EACD;IACE,KAAK;IACL,GAAG;CACJ,CACF,CAAC;AACF,MAAM,CAAC,gBAAgB,CAAC,aAAK,EAAE;IAC7B,MAAM,EAAE;QACN,GAAG;YACD,MAAM,CAAC,MAAM,KAAK,CAAC,CAAC;QACtB,CAAC;KACF;IACD,KAAK,EAAE;QACL,GAAG;YACD,MAAM,CAAC,MAAM,CAAC;QAChB,CAAC;KACF;CACF,CAAC,CAAC;AAEH,mBAA0B,KAAa;IACrC,MAAM,CAAC,KAAK,KAAK,CAAC,CAAC,IAAI,CAAC,KAAK,KAAK,CAAC,IAAI,KAAK,KAAK,MAAM,CAAC,CAAC;AAC3D,CAAC;AAFD,8BAEC","file":"ownership.js","sourcesContent":["var _nextId = 0;\r\nexport function nextId() {\r\n  return ++_nextId;\r\n}\r\n\r\nvar _owner = 0, _depth = 0;\r\nexport interface Batch {\r\n  (callback: (owner?: number) => void): any;\r\n  <T>(callback: (owner?: number) => void): T;\r\n  start(): void;\r\n  end(): boolean;\r\n  readonly active: boolean;\r\n  readonly owner: number;\r\n}\r\n\r\nfunction start(): void {\r\n  if(_depth === 0) {\r\n    _owner = nextId();\r\n  }\r\n  else {\r\n  }\r\n  _depth++;\r\n}\r\n\r\nfunction end(): boolean {\r\n  if(_depth > 0) {\r\n    if(--_depth > 0) {\r\n      return false;\r\n    }\r\n    _owner = 0;\r\n  }\r\n  return true;\r\n}\r\n\r\nexport const batch: Batch = <any>Object.assign(\r\n  function (callback: (owner?: number) => any): any {\r\n    start();\r\n    var result = callback(_owner);\r\n    end();\r\n    return result;\r\n  },\r\n  {\r\n    start,\r\n    end\r\n  }\r\n);\r\nObject.defineProperties(batch, {\r\n  active: {\r\n    get(): boolean {\r\n      return _owner !== 0;\r\n    }\r\n  },\r\n  owner: {\r\n    get(): number {\r\n      return _owner;\r\n    }\r\n  }\r\n});\r\n\r\nexport function isMutable(owner: number): boolean {\r\n  return owner === -1 || (owner !== 0 && owner === _owner);\r\n}"]}